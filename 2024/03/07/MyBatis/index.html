<!DOCTYPE html><html class="appearance-auto" lang="zh-CH"><head><meta charset="UTF-8"><title>Mybatis</title><meta name="description" content="My girlfriend is Xia Yue"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="环境：

JDK1.8
Mysql 5.7
maven 3.6.1
IDEA

回顾：

JDBC
Mysql
Java基础
Maven
Junit

SSM框架：配置文件的。最好的方式：看官网文档
简介
什么是MyBatis



MyBatis 是一款优秀的==持久层框架==，


它支持定制化 SQL、存储过程以及高级映射。


MyBatis本是apache的一个开源项目iBatis，2010年这个项目由apache software foundation迁移到了[google code](https://baike.baidu.com/item/google code/2346604?fromModule=lemma_inlink)，并且改名为MyBatis。


2013年11月迁移到Githu.."><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">xoitao's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Mybatis</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFMyBatis"><span class="toc-text">什么是MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%B1%82"><span class="toc-text">持久层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81MyBatis"><span class="toc-text">为什么需要MyBatis?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAMyBatis%E7%A8%8B%E5%BA%8F"><span class="toc-text">第一个MyBatis程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-text">搭建环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%A8%A1%E5%9D%97"><span class="toc-text">创建一个模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-text">编写代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRUD"><span class="toc-text">CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#namespace"><span class="toc-text">namespace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select"><span class="toc-text">select</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert"><span class="toc-text">insert</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update"><span class="toc-text">update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete"><span class="toc-text">delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E9%94%99%E8%AF%AF"><span class="toc-text">分析错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E7%9A%84Map"><span class="toc-text">万能的Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%80%83%E9%A2%98"><span class="toc-text">思考题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"><span class="toc-text">配置解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">核心配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%EF%BC%88environments%EF%BC%89"><span class="toc-text">环境配置（environments）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%EF%BC%88properties%EF%BC%89"><span class="toc-text">属性（properties）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%EF%BC%88typeAliases%EF%BC%89"><span class="toc-text">类型别名（typeAliases）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%EF%BC%88settings%EF%BC%89"><span class="toc-text">设置（settings）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-text">其他配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%99%A8%EF%BC%88mappers%EF%BC%89"><span class="toc-text">映射器（mappers）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">生命周期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%B1%9E%E6%80%A7%E5%90%8D%E5%92%8C%E5%AD%97%E6%AE%B5%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">解决属性名和字段名不一致的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-text">问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#resultMap"><span class="toc-text">resultMap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-text">日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%B7%A5%E5%8E%82"><span class="toc-text">日志工厂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Log4j"><span class="toc-text">Log4j</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5"><span class="toc-text">分页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8limit%E5%88%86%E9%A1%B5"><span class="toc-text">使用limit分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RowBounds%E5%88%86%E9%A1%B5"><span class="toc-text">RowBounds分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text">分页插件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">使用注解开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B"><span class="toc-text">面向接口编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91-2"><span class="toc-text">使用注解开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRUD-2"><span class="toc-text">CRUD</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lombok"><span class="toc-text">Lombok</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E4%B8%80"><span class="toc-text">多对一</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">测试环境搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E6%9F%A5%E8%AF%A2%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86"><span class="toc-text">按照查询嵌套处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E7%BB%93%E6%9E%9C%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86"><span class="toc-text">按照结果嵌套处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">一对多</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%8C%E5%92%8C%E5%88%9A%E6%89%8D%E4%B8%80%E6%A0%B7"><span class="toc-text">环境搭建，和刚才一样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E7%BB%93%E6%9E%9C%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86-2"><span class="toc-text">按照结果嵌套处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%85%A7%E6%9F%A5%E8%AF%A2%E5%B5%8C%E5%A5%97%E5%A4%84%E7%90%86-2"><span class="toc-text">按照查询嵌套处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81SQL"><span class="toc-text">动态SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#if"><span class="toc-text">if</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choose-when%E3%80%81otherwise"><span class="toc-text">choose(when、otherwise)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trim-where%E3%80%81set"><span class="toc-text">trim(where、set)</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Mybatis</h1><time class="has-text-grey" datetime="2024-03-06T21:20:00.000Z">2024-03-07</time><article class="mt-2 post-content"><p>环境：</p>
<ul>
<li>JDK1.8</li>
<li>Mysql 5.7</li>
<li>maven 3.6.1</li>
<li>IDEA</li>
</ul>
<p>回顾：</p>
<ul>
<li>JDBC</li>
<li>Mysql</li>
<li>Java基础</li>
<li>Maven</li>
<li>Junit</li>
</ul>
<p>SSM框架：配置文件的。最好的方式：看官网文档</p>
<h2 id="简介">简介</h2>
<h3 id="什么是MyBatis">什么是MyBatis</h3>
<p><img src="/images/image-20240402210104257.png" alt="image-20240402210104257"></p>
<ul>
<li>
<p>MyBatis 是一款优秀的==持久层框架==，</p>
</li>
<li>
<p>它支持定制化 SQL、存储过程以及高级映射。</p>
</li>
<li>
<p>MyBatis本是apache的一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/3406069?fromModule=lemma_inlink">开源项目</a>iBatis，2010年这个项目由apache software foundation迁移到了[google code](<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/google">https://baike.baidu.com/item/google</a> code/2346604?fromModule=lemma_inlink)，并且改名为MyBatis。</p>
</li>
<li>
<p>2013年11月迁移到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Github/10145341?fromModule=lemma_inlink">Github</a>。</p>
</li>
</ul>
<p>如何获得MyBatis?</p>
<ul>
<li>
<p>maven仓库</p>
<pre><code class="language-xml">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
    &lt;version&gt;3.5.15&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>GItHub <a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a></p>
</li>
<li>
<p>中文文档 <a target="_blank" rel="noopener" href="http://www.mybatis.cn/mybatis/index.html">MyBatis 入门介绍</a></p>
</li>
</ul>
<h3 id="持久化">持久化</h3>
<p>数据持久化</p>
<ul>
<li>
<p>持久化就是将程序的数据在持久状态和瞬时状态转化的过程</p>
</li>
<li>
<p>内存：==断电即失==</p>
</li>
<li>
<p>数据库(jdbc)，io文件持久化</p>
</li>
<li>
<p>生活：冷藏，罐头</p>
</li>
</ul>
<p>为什么需要持久化？</p>
<ul>
<li>有一些对象，不能让他丢掉</li>
<li>内存太贵了</li>
</ul>
<h3 id="持久层">持久层</h3>
<p>Dao层，Service层，Controller层…</p>
<ul>
<li>完成持久化工作的代码块</li>
<li>层界限十分明显</li>
</ul>
<h3 id="为什么需要MyBatis">为什么需要MyBatis?</h3>
<ul>
<li>
<p>帮助程序猿将数据存入到数据库中</p>
</li>
<li>
<p>方便</p>
</li>
<li>
<p>传统的JDBC代码太复杂了。简化。框架。自动化。</p>
</li>
<li>
<p>不用MyBatis也可以。更容易上手。==技术没有高低之分==</p>
</li>
<li>
<p>优点：</p>
<ul>
<li>简单易学</li>
<li>灵活</li>
<li>解除sql与程序代码的耦合。sql和代码的分离，提高了可维护性。</li>
<li>提供映射标签，支持对象与数据库的ORM字段关系映射。</li>
<li>提供对象关系映射标签，支持对象关系组建维护。</li>
<li>提供xml标签，支持编写动态sql</li>
</ul>
</li>
</ul>
<p>==最重要的一点：使用的人多！==</p>
<p>Spring     SpringMVC    SpringBoot</p>
<h2 id="第一个MyBatis程序">第一个MyBatis程序</h2>
<p>思路：搭建环境—&gt;导入MyBatis—&gt;编写代码—&gt;测试！</p>
<h3 id="搭建环境">搭建环境</h3>
<p>搭建数据库</p>
<pre><code class="language-java">CREATE DATABASE `mybatis`;
USE `mybatis`;

CREATE TABLE `user`(
	`id` INT(20) NOT NULL,
	`name` VARCHAR(30) DEFAULT NULL,
	`pwd` VARCHAR(30) DEFAULT NULL,
	PRIMARY KEY (id)
)ENGINE=INNODB DEFAULT CHARSET=utf8;


INSERT INTO `user` (`id`, `name`, `pwd`) VALUES
(1, '张三', 123456),
(2, '李四', 123456),
(3, '王五', 123456)
</code></pre>
<p>新建项目</p>
<ol>
<li>
<p>新建一个普通的maven项目</p>
</li>
<li>
<p>删除src目录</p>
</li>
<li>
<p>导入maven依赖</p>
<pre><code class="language-xml">&lt;dependencies&gt;
    &lt;!--mysql驱动--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;8.0.32&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--mybatis--&gt;
    &lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
        &lt;version&gt;3.5.15&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
</li>
</ol>
<h3 id="创建一个模块">创建一个模块</h3>
<ul>
<li>
<p>编写mybatis的核心配置文件</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;!--configuration核心配置文件--&gt;
&lt;configuration&gt;
    &lt;environments default=&quot;development&quot;&gt;
        &lt;environment id=&quot;development&quot;&gt;
            &lt;transactionManager type=&quot;JDBC&quot;/&gt;
            &lt;dataSource type=&quot;POOLED&quot;&gt;
                &lt;property name=&quot;driver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;
                &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;userUnicode=true&amp;amp;characterEncoding-UTF-8&quot;/&gt;
                &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
                &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;
            &lt;/dataSource&gt;
        &lt;/environment&gt;
    &lt;/environments&gt;
    &lt;mappers&gt;
        &lt;mapper resource=&quot;org/mybatis/example/BlogMapper.xml&quot;/&gt;
    &lt;/mappers&gt;
&lt;/configuration&gt;
</code></pre>
</li>
<li>
<p>编写mybatis工具类</p>
<pre><code class="language-java">//sqlSessionFactory ---&gt; sqlSession
public class MybatisUtils &#123;

    private static SqlSessionFactory sqlSessionFactory;

    static &#123;
        try &#123;
            // 使用Mybatis第一步：获取sqlSessionFactory对象
            String resource = &quot;mybatis-config.xml&quot;;
            InputStream inputStream = Resources.getResourceAsStream(resource);
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        &#125; catch (IOException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;

    //既然有了 SqlSessionFactory，顾名思义，我们可以从中获得 SqlSession 的实例。
    //SqlSession 提供了在数据库执行SQL 命令所需的所有方法。
    public static SqlSession getSqlSession() &#123;
        return sqlSessionFactory.openSession();
    &#125;
&#125;
</code></pre>
</li>
</ul>
<h3 id="编写代码">编写代码</h3>
<ul>
<li>
<p>实体类</p>
<pre><code class="language-java">// 实体类
public class User &#123;
    private int id;
    private String name;
    private String pwd;

    public User() &#123;
    &#125;

    public User(int id, String name, String pwd) &#123;
        this.id = id;
        this.name = name;
        this.pwd = pwd;
    &#125;

    public int getId() &#123;
        return id;
    &#125;

    public String getName() &#123;
        return name;
    &#125;

    public String getPwd() &#123;
        return pwd;
    &#125;

    public void setId(int id) &#123;
        this.id = id;
    &#125;

    public void setName(String name) &#123;
        this.name = name;
    &#125;

    public void setPwd(String pwd) &#123;
        this.pwd = pwd;
    &#125;

    @Override
    public String toString() &#123;
        return &quot;User&#123;&quot; +
                &quot;id=&quot; + id +
                &quot;, name='&quot; + name + '\'' +
                &quot;, pwd='&quot; + pwd + '\'' +
                '&#125;';
    &#125;
&#125;
</code></pre>
</li>
<li>
<p>Dao接口</p>
<pre><code class="language-java">public interface UserDao &#123;
    List&lt;User&gt; getUserList();
&#125;
</code></pre>
</li>
<li>
<p>接口实现类由原来的UserDaoImpl转变为一个Mapper配置文件</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;!--namespace=绑定一个对应的Dao/Mapper接口--&gt;
&lt;mapper namespace=&quot;com.xoitao.dao.UserDao&quot;&gt;
    &lt;!--select查询语句--&gt;
    &lt;select id=&quot;getUserList&quot; resultType=&quot;com.xoitao.pojo.User&quot;&gt;
        select * from mybatis.user
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre>
</li>
</ul>
<h3 id="测试">测试</h3>
<ul>
<li>
<p>junit测试</p>
<pre><code class="language-java">@Test
public void test()&#123;
    // 第一步：获得SqlSession对象
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    // 方式一：getMapper
    UserDao userDao = sqlSession.getMapper(UserDao.class);
    List&lt;User&gt; userList = userDao.getUserList();
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
    // 关闭sqlSession
    sqlSession.close();
&#125;
</code></pre>
</li>
</ul>
<p>测试中遇到的问题</p>
<ol>
<li>
<p>配置文件没有注册</p>
<p>org.apache.ibatis.binding.BindingException: Type interface com.xoitao.dao.UserDao is not known to the MapperRegistry.</p>
<p><strong>MapperRegistry是什么？</strong></p>
<p>核心配置文件中注册mappers</p>
</li>
<li>
<p>绑定接口错误</p>
</li>
<li>
<p>方法名不对</p>
</li>
<li>
<p>返回类型不对</p>
</li>
<li>
<p>Maven导出资源问题</p>
<pre><code class="language-xml">&lt;!--在build中配置resources,来防止我们资源导出失败的问题--&gt;
&lt;build&gt;
    &lt;resources&gt;
        &lt;resource&gt;
            &lt;directory&gt;src/main/resources&lt;/directory&gt;
            &lt;includes&gt;
                &lt;include&gt;**/*.properties&lt;/include&gt;
                &lt;include&gt;**/*.xml&lt;/include&gt;
            &lt;/includes&gt;
            &lt;filtering&gt;true&lt;/filtering&gt;
        &lt;/resource&gt;
        &lt;resource&gt;
            &lt;directory&gt;src/main/java&lt;/directory&gt;
            &lt;includes&gt;
                &lt;include&gt;**/*.properties&lt;/include&gt;
                &lt;include&gt;**/*.xml&lt;/include&gt;
            &lt;/includes&gt;
            &lt;filtering&gt;true&lt;/filtering&gt;
        &lt;/resource&gt;
    &lt;/resources&gt;
&lt;/build&gt;
</code></pre>
</li>
<li>
<p>编码问题</p>
<p>Caused by: com.sun.org.apache.xerces.internal.impl.io.MalformedByteSequenceExcep<br>
tion: 1 字节的 UTF-8 序列的字节 1 无效。<br>
Caused by: org.apache.ibatis.builder.BuilderException: Error creating document instance.  Cause: com.sun.org.apache.xerces.internal.impl.io.MalformedByteSequenceException:<br>
1 字节的 UTF-8 序列的字节 1 无效。</p>
<p>将IDEA默认的编码格式都改成UTF-8</p>
</li>
</ol>
<h2 id="CRUD">CRUD</h2>
<h3 id="namespace">namespace</h3>
<p>namespace中的包名要和Dao/Mapper接口的包名一致！</p>
<h3 id="select">select</h3>
<p>选择、查询语句</p>
<ul>
<li>id：就是对应的namespace中的方法名</li>
<li>resultType：sql语句执行的返回值</li>
<li>parameterType：参数类型</li>
</ul>
<ol>
<li>
<p>编写接口</p>
<pre><code class="language-java">// 根据ID查询用户
User getUserById(int id);
</code></pre>
</li>
<li>
<p>编写对应的mapper中的sql语句</p>
<pre><code class="language-xml">&lt;select id=&quot;getUserById&quot; parameterType=&quot;int&quot; resultType=&quot;com.xoitao.pojo.User&quot;&gt;
    select * from mybatis.user where id = #&#123;id&#125;;
&lt;/select&gt;
</code></pre>
</li>
<li>
<p>测试</p>
<pre><code class="language-java">@Test
public void getUserById()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    User user = mapper.getUserById(1);
    System.out.println(user);
    System.out.println(UserMapper.class);
    sqlSession.close();
&#125;
</code></pre>
</li>
</ol>
<h3 id="insert">insert</h3>
<pre><code class="language-xml">&lt;insert id=&quot;addUser&quot; parameterType=&quot;com.xoitao.pojo.User&quot;&gt;
    insert into mybatis.user (id, name, pwd) values (#&#123;id&#125;, #&#123;name&#125;, #&#123;pwd&#125;);
&lt;/insert&gt;
</code></pre>
<h3 id="update">update</h3>
<pre><code class="language-xml">&lt;update id=&quot;updateUser&quot; parameterType=&quot;com.xoitao.pojo.User&quot;&gt;
    update mybatis.user set name=#&#123;name&#125;, pwd=#&#123;pwd&#125; where id = #&#123;id&#125;;
&lt;/update&gt;
</code></pre>
<h3 id="delete">delete</h3>
<pre><code class="language-xml">&lt;delete id=&quot;deleteUser&quot; parameterType=&quot;int&quot;&gt;
    delete from mybatis.user where id = #&#123;id&#125;;
&lt;/delete&gt;
</code></pre>
<blockquote>
<p>==增删改需要提交事务！==</p>
</blockquote>
<h3 id="分析错误">分析错误</h3>
<ul>
<li>标签不要匹配错</li>
<li>resource绑定mapper，需要使用路径（‘’/‘’）</li>
<li>程序配置文件必须符合规范</li>
<li>空指针异常，没有注册到资源</li>
<li>输出xml文件中存在乱码问题</li>
<li>maven资源没有导出问题！</li>
</ul>
<h3 id="万能的Map">万能的Map</h3>
<p>假设，我们的实体类，或者数据库中表，字段或者参数过多，我们应当考虑使用Map！</p>
<pre><code class="language-java">User getUserById(Map&lt;String, Object&gt; map);
</code></pre>
<pre><code class="language-xml">&lt;select id=&quot;getUserById2&quot; parameterType=&quot;map&quot; resultType=&quot;com.xoitao.pojo.User&quot;&gt;
    select * from mybatis.user where id = #&#123;id&#125;;
&lt;/select&gt;
</code></pre>
<pre><code class="language-java">@Test
public void getUserById2()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
    map.put(&quot;id&quot;,1);
    User user = mapper.getUserById2(map);
    System.out.println(user);
    sqlSession.close();
&#125;
</code></pre>
<p>Map传递参数，直接在sql中取出key即可！【parameterType=“map”】</p>
<p>对象传递参数，直接在sql中取对象的属性即可！【parameterType=“com.xoitao.pojo.User”】</p>
<p>只有一个基本类型类型参数的情况下，可以直接在sql中取到！</p>
<p>多个参数用Map，或者==注解==</p>
<h3 id="思考题">思考题</h3>
<p>模糊查询怎么写？</p>
<ol>
<li>
<p>Java代码执行的时候，传递通配符% %</p>
<pre><code class="language-java">List&lt;User&gt; userList = mapper.getUserLike(&quot;%李%&quot;);
</code></pre>
</li>
<li>
<p>在sql拼接中使用通配符！</p>
<pre><code class="language-java">select * from mybatis.user where name like &quot;%&quot;#&#123;value&#125;&quot;%&quot;;
</code></pre>
</li>
</ol>
<h2 id="配置解析">配置解析</h2>
<h3 id="核心配置文件">核心配置文件</h3>
<ul>
<li>
<p>mybatis-config.xml</p>
</li>
<li>
<p>MyBatis 的配置文件包含了会深深影响 MyBatis 行为的设置和属性信息。</p>
<pre><code class="language-xml">configuration（配置）
properties（属性）
settings（设置）
typeAliases（类型别名）
typeHandlers（类型处理器）
objectFactory（对象工厂）
plugins（插件）
environments（环境配置）
environment（环境变量）
transactionManager（事务管理器）
dataSource（数据源）
databaseIdProvider（数据库厂商标识）
mappers（映射器）
</code></pre>
</li>
</ul>
<h3 id="环境配置（environments）">环境配置（environments）</h3>
<p>MyBatis 可以配置成适应多种环境</p>
<p><strong>不过要记住：尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></p>
<p>学会使用配置多套运行环境！</p>
<p>MyBatis默认的事务管理器就是JDBC，连接池：POOLED</p>
<h3 id="属性（properties）">属性（properties）</h3>
<p>我们可以通过Properties属性来实现引用配置文件</p>
<p>这些属性可以在外部进行配置，并可以进行动态替换。既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。【db.properties】</p>
<p>(properties?,settings?,typeAliases?,typeHandlers?,objectFactory?,objectWrapperFactory?,reflectorFactory?,plugins?,environments?,databaseIdProvider?,mappers?)&quot;.</p>
<p>编写一个配置文件</p>
<p>db.properties</p>
<pre><code class="language-properties">driver=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;userUnicode=true&amp;characterEncoding=UTF-8
username=root
password=123456
</code></pre>
<p>在核心配置文件中引入</p>
<pre><code class="language-xml">&lt;!--引入外部配置文件--&gt;
&lt;properties resource=&quot;db.properties&quot;&gt;
    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
    &lt;property name=&quot;pwd&quot; value=&quot;123456&quot;/&gt;
&lt;/properties&gt;
</code></pre>
<ul>
<li>可以直接引入外部文件</li>
<li>可以在其中增加一些属性配置</li>
<li>如果两个文件有同一个字段，优先使用外部配置文件的！</li>
</ul>
<h3 id="类型别名（typeAliases）">类型别名（typeAliases）</h3>
<ul>
<li>
<p>类型别名可为 Java 类型设置一个缩写名字。</p>
</li>
<li>
<p>它仅用于 XML 配置，意在降低冗余的全限定类名书写。</p>
</li>
</ul>
<pre><code class="language-xml">&lt;!--可以给实体类起别名--&gt;
&lt;typeAliases&gt;
    &lt;typeAlias type=&quot;com.xoitao.pojo.User&quot; alias=&quot;User&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>
<p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p>
<p>扫描实体类的包，它的默认别名就为这个类的类名，首字母小写！</p>
<pre><code class="language-xml">&lt;!--可以给实体类起别名--&gt;
&lt;typeAliases&gt;
    &lt;package name=&quot;com.xoitao.pojo&quot;/&gt;
&lt;/typeAliases&gt;
</code></pre>
<p>在实体类少的时候使用第一种方式，如果实体类十分多，建议使用第二种</p>
<p>第一种可以DIY别名，第二种则不行，如果非要改，需要在实体类上增加注解</p>
<pre><code class="language-java">@Alias(&quot;user&quot;)
public class User &#123;&#125;
</code></pre>
<h3 id="设置（settings）">设置（settings）</h3>
<p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。</p>
<table>
<thead>
<tr>
<th style="text-align:left">设置名</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">有效值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">logImpl</td>
<td style="text-align:left">指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td style="text-align:left">SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td style="text-align:left">未设置</td>
</tr>
<tr>
<td style="text-align:left">cacheEnabled</td>
<td style="text-align:left">全局性地开启或关闭所有映射器配置文件中已配置的任何缓存。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">lazyLoadingEnabled</td>
<td style="text-align:left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td>
<td style="text-align:left">true | false</td>
<td style="text-align:left">false</td>
</tr>
</tbody>
</table>
<h3 id="其他配置">其他配置</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#typeHandlers">typeHandlers（类型处理器）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#objectFactory">objectFactory（对象工厂）</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.net.cn/configuration.html#plugins">plugins（插件）</a>
<ul>
<li>mybatis-generator-croe</li>
<li>mybatis-plus</li>
<li>通用mapper</li>
</ul>
</li>
</ul>
<h3 id="映射器（mappers）">映射器（mappers）</h3>
<p>MapperRegistry：注册绑定我们的Mapper文件</p>
<p>方式一：【推荐使用】</p>
<pre><code class="language-xml">&lt;mappers&gt;
    &lt;mapper resource=&quot;com/xoitao/dao/UserMapper.xml&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
<p>方式二：使用class文件绑定注册</p>
<pre><code class="language-xml">&lt;mappers&gt;
    &lt;!--&lt;mapper resource=&quot;com/xoitao/dao/UserMapper.xml&quot;/&gt;--&gt;
    &lt;mapper class=&quot;com.xoitao.dao.UserMapper&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
<p>注意点：</p>
<ul>
<li>接口和它的Mapper配置文件必须同名</li>
<li>接口和它的Mapper配置文件必须在同一个包下</li>
</ul>
<p>方式三：使用扫描包进行注入绑定</p>
<pre><code class="language-xml">&lt;mappers&gt;
    &lt;package name=&quot;com.xoitao.dao&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
<p>注意点：</p>
<ul>
<li>接口和它的Mapper配置文件必须同名</li>
<li>接口和它的Mapper配置文件必须在同一个包下</li>
</ul>
<h3 id="生命周期">生命周期</h3>
<p><img src="/images/image-20240404203834453.png" alt="image-20240404203834453"></p>
<p>作用域和生命周期是至关重要的，因为错误的使用会导致非常严重的==并发问题==。</p>
<p><strong>SqlSessionFactoryBuilder：</strong></p>
<ul>
<li>
<p>一旦创建了 SqlSessionFactory，就不再需要它了</p>
</li>
<li>
<p>局部变量</p>
</li>
</ul>
<p><strong>SqlSessionFactory：</strong></p>
<ul>
<li>
<p>说白了就是可以想象为：数据库连接池</p>
</li>
<li>
<p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，<strong>没有任何理由丢弃它或重新创建另一个实例。</strong></p>
</li>
<li>
<p>因此 SqlSessionFactory 的最佳作用域是应用作用域。</p>
</li>
<li>
<p>最简单的就是使用<strong>单例模式</strong>或者静态单例模式。</p>
</li>
</ul>
<p><strong>SqlSession：</strong></p>
<ul>
<li>连接到连接池的一个请求！</li>
<li>SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。</li>
<li>用完之后需要赶紧关闭，否则资源被占用！</li>
</ul>
<p><img src="/images/image-20240404203934139.png" alt="image-20240404203934139"></p>
<p>这里每一个Mapper，就代表一个具体的业务！</p>
<h2 id="解决属性名和字段名不一致的问题">解决属性名和字段名不一致的问题</h2>
<h3 id="问题">问题</h3>
<p>数据库中的字段</p>
<p>新建一个项目，拷贝之前的，测试实体类字段不一致的情况</p>
<pre><code class="language-java">public class User &#123;
    private int id;
    private String name;
    private String password;
&#125;
</code></pre>
<p>测试出现问题</p>
<pre><code>User&#123;id=1, name='程文涛', password='null'&#125;
</code></pre>
<pre><code class="language-java">select * from mybatis.user where id = #&#123;id&#125;;
select id, name, pwd from mybatis.user where id = #&#123;id&#125;;
</code></pre>
<p>解决方法：</p>
<ul>
<li>
<p>起别名</p>
<pre><code class="language-xml">&lt;select id=&quot;getUserById&quot; parameterType=&quot;int&quot; resultType=&quot;User&quot;&gt;
    select id, name, pwd as password from mybatis.user where id = #&#123;id&#125;;
&lt;/select&gt;
</code></pre>
</li>
</ul>
<h3 id="resultMap">resultMap</h3>
<p>结构集映射</p>
<pre><code>id name pwd
id name password
</code></pre>
<pre><code class="language-xml">&lt;!--结果集映射--&gt;
&lt;resultMap id=&quot;UserMap&quot; type=&quot;User&quot;&gt;
    &lt;!--column数据库中的字段，property实体类中的属性--&gt;
    &lt;result column=&quot;id&quot; property=&quot;id&quot;/&gt;
    &lt;result column=&quot;name&quot; property=&quot;name&quot;/&gt;
    &lt;result column=&quot;pwd&quot; property=&quot;password&quot;/&gt;
&lt;/resultMap&gt;
&lt;select id=&quot;getUserById&quot; parameterType=&quot;int&quot; resultMap=&quot;UserMap&quot;&gt;
    select * from mybatis.user where id = #&#123;id&#125;;
&lt;/select&gt;
</code></pre>
<ul>
<li>
<p><code>resultMap</code> 元素是 MyBatis 中最重要最强大的元素。</p>
</li>
<li>
<p>ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。</p>
</li>
<li>
<p><code>ResultMap</code> 的优秀之处——你完全可以不用显式地配置它们。</p>
</li>
</ul>
<h2 id="日志">日志</h2>
<h3 id="日志工厂">日志工厂</h3>
<p>如果一个数据库操作，出现了异常，我们需要排错，日志就是最好的助手！</p>
<p>曾经：sout、debug</p>
<p>现在：日志工厂！</p>
<table>
<thead>
<tr>
<th style="text-align:center">设置名</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">有效值</th>
<th style="text-align:center">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">logImpl</td>
<td style="text-align:center">指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td style="text-align:center">SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td style="text-align:center">未设置</td>
</tr>
</tbody>
</table>
<ul>
<li>SLF4J</li>
<li>LOG4J      【掌握】</li>
<li>LOG4J2</li>
<li>JDK_LOGGING</li>
<li>COMMONS_LOGGING</li>
<li>STDOUT_LOGGING   【掌握】</li>
<li>NO_LOGGING</li>
</ul>
<p>在mybatis中具体使用哪一个日志实现，在设置中设定！</p>
<p><strong>STDOUT_LOGGING 标准日志输出</strong></p>
<p>在mybatis核心配置文件中，配置我们的日志！</p>
<pre><code class="language-xml">&lt;settings&gt;
    &lt;setting name=&quot;logImpl&quot; value=&quot;STDOUT_LOGGING&quot;/&gt;
&lt;/settings&gt;
</code></pre>
<pre><code>Opening JDBC Connection
Created connection 1504642150.
Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@59af0466]
==&gt;  Preparing: select * from mybatis.user where id = ?;
==&gt; Parameters: 1(Integer)
&lt;==    Columns: id, name, pwd
&lt;==        Row: 1, 程文涛, 123
&lt;==      Total: 1
User&#123;id=1, name='程文涛', password='123'&#125;
Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@59af0466]
Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@59af0466]
Returned connection 1504642150 to pool.
</code></pre>
<h3 id="Log4j">Log4j</h3>
<p>什么事Log4j?</p>
<ul>
<li>Log4j是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Apache/8512995?fromModule=lemma_inlink">Apache</a>的一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/3406069?fromModule=lemma_inlink">开源项目</a>，通过使用Log4j，我们可以控制日志信息输送的目的地是<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8E%A7%E5%88%B6%E5%8F%B0/2438626?fromModule=lemma_inlink">控制台</a>、文件、GUI组件</li>
<li>我们也可以控制每一条日志的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F/14456488?fromModule=lemma_inlink">输出格式</a></li>
<li>通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。</li>
<li>可以通过一个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/286550?fromModule=lemma_inlink">配置文件</a>来灵活地进行配置，而不需要修改应用的代码。</li>
</ul>
<ol>
<li>
<p>先导入log4j的包</p>
<pre><code class="language-xml">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;log4j&lt;/groupId&gt;
    &lt;artifactId&gt;log4j&lt;/artifactId&gt;
    &lt;version&gt;1.2.17&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>log4j.properties</p>
<pre><code class="language-properties">#将等级为DEBUG的日志信息输出到console和file这两个目的地，console和file的定义在下面的代码
log4j.rootLogger=DEBUG,console,file

#控制台输出的相关设置
log4j.appender.console = org.apache.log4j.ConsoleAppender
log4j.appender.console.Target = System.out
log4j.appender.console.Threshold=DEBUG
log4j.appender.console.layout = org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=[%c]-%m%n

#文件输出的相关设置
log4j.appender.file = org.apache.log4j.RollingFileAppender
log4j.appender.file.File=./log/xoitao.log
log4j.appender.file.MaxFileSize=10mb
log4j.appender.file.Threshold=DEBUG
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n

#日志输出级别
log4j.logger.org.mybatis=DEBUG
log4j.logger.java.sql=DEBUG
log4j.logger.java.sql.Statement=DEBUG
log4j.logger.java.sql.ResultSet=DEBUG
log4j.logger.java.sql.PreparedStatement=DEBUG
</code></pre>
</li>
<li>
<p>配置log4j为日志的实现</p>
<pre><code class="language-xml">&lt;settings&gt;
    &lt;setting name=&quot;logImpl&quot; value=&quot;Log4j&quot;/&gt;
&lt;/settings&gt;
</code></pre>
</li>
<li>
<p>log4j的使用！直接测试运行刚才的查询</p>
<pre><code>[org.apache.ibatis.logging.LogFactory]-Logging initialized using 'class org.apache.ibatis.logging.log4j.Log4jImpl' adapter.
[org.apache.ibatis.logging.LogFactory]-Logging initialized using 'class org.apache.ibatis.logging.log4j.Log4jImpl' adapter.
[org.apache.ibatis.io.VFS]-Class not found: org.jboss.vfs.VFS
[org.apache.ibatis.io.JBoss6VFS]-JBoss 6 VFS API is not available in this environment.
[org.apache.ibatis.io.VFS]-Class not found: org.jboss.vfs.VirtualFile
[org.apache.ibatis.io.VFS]-VFS implementation org.apache.ibatis.io.JBoss6VFS is not valid in this environment.
[org.apache.ibatis.io.VFS]-Using VFS adapter org.apache.ibatis.io.DefaultVFS
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/pojo
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/pojo
[org.apache.ibatis.io.DefaultVFS]-Reader entry: User.class
[org.apache.ibatis.io.DefaultVFS]-Listing file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/pojo
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/pojo/User.class
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/pojo/User.class
[org.apache.ibatis.io.DefaultVFS]-Reader entry:        4 @
[org.apache.ibatis.io.ResolverUtil]-Checking to see if class com.xoitao.pojo.User matches criteria [is assignable to Object]
[org.apache.ibatis.datasource.pooled.PooledDataSource]-PooledDataSource forcefully closed/removed all connections.
[org.apache.ibatis.datasource.pooled.PooledDataSource]-PooledDataSource forcefully closed/removed all connections.
[org.apache.ibatis.datasource.pooled.PooledDataSource]-PooledDataSource forcefully closed/removed all connections.
[org.apache.ibatis.datasource.pooled.PooledDataSource]-PooledDataSource forcefully closed/removed all connections.
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/test-classes/com/xoitao/dao
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/test-classes/com/xoitao/dao
[org.apache.ibatis.io.DefaultVFS]-Reader entry: UserMapperTest.class
[org.apache.ibatis.io.DefaultVFS]-Listing file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/test-classes/com/xoitao/dao
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/test-classes/com/xoitao/dao/UserMapperTest.class
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/test-classes/com/xoitao/dao/UserMapperTest.class
[org.apache.ibatis.io.DefaultVFS]-Reader entry:        4 9
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao
[org.apache.ibatis.io.DefaultVFS]-Reader entry: UserMapper.class
[org.apache.ibatis.io.DefaultVFS]-Reader entry: UserMapper.xml
[org.apache.ibatis.io.DefaultVFS]-Listing file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao/UserMapper.class
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao/UserMapper.class
[org.apache.ibatis.io.DefaultVFS]-Reader entry:        4 	  getUserById (I)Lcom/xoitao/pojo/User; 
[org.apache.ibatis.io.DefaultVFS]-Find JAR URL: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao/UserMapper.xml
[org.apache.ibatis.io.DefaultVFS]-Not a JAR: file:/D:/study/IdeaProjects/MyBatis-Study/mybatis-04/target/classes/com/xoitao/dao/UserMapper.xml
[org.apache.ibatis.io.DefaultVFS]-Reader entry: &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
[org.apache.ibatis.io.ResolverUtil]-Checking to see if class com.xoitao.dao.UserMapperTest matches criteria [is assignable to Object]
[org.apache.ibatis.io.ResolverUtil]-Checking to see if class com.xoitao.dao.UserMapper matches criteria [is assignable to Object]
[org.apache.ibatis.transaction.jdbc.JdbcTransaction]-Opening JDBC Connection
[org.apache.ibatis.datasource.pooled.PooledDataSource]-Created connection 1325144078.
[org.apache.ibatis.transaction.jdbc.JdbcTransaction]-Setting autocommit to false on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4efc180e]
[com.xoitao.dao.UserMapper.getUserById]-==&gt;  Preparing: select * from mybatis.user where id = ?;
[com.xoitao.dao.UserMapper.getUserById]-==&gt; Parameters: 1(Integer)
[com.xoitao.dao.UserMapper.getUserById]-&lt;==      Total: 1
User&#123;id=1, name='程文涛', password='123'&#125;
[org.apache.ibatis.transaction.jdbc.JdbcTransaction]-Resetting autocommit to true on JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4efc180e]
[org.apache.ibatis.transaction.jdbc.JdbcTransaction]-Closing JDBC Connection [com.mysql.cj.jdbc.ConnectionImpl@4efc180e]
[org.apache.ibatis.datasource.pooled.PooledDataSource]-Returned connection 1325144078 to pool.
</code></pre>
</li>
</ol>
<p><strong>简单使用</strong></p>
<ol>
<li>
<p>在要使用Log4j的类中，导入包   import org.apache.log4j.Logger;</p>
</li>
<li>
<p>日志对象，加载参数为当前类的class</p>
<pre><code class="language-java">static Logger logger = Logger.getLogger(UserMapperTest.class);
</code></pre>
</li>
<li>
<p>日志级别</p>
<pre><code class="language-java">@Test
public void testLog4j()&#123;
    logger.info(&quot;info:进入了testLog4j&quot;);
    logger.debug(&quot;debug:进入了testLog4j&quot;);
    logger.error(&quot;error:进入了testLog4j&quot;);
&#125;
</code></pre>
</li>
</ol>
<h2 id="分页">分页</h2>
<p><strong>思考：为什么要分页？</strong></p>
<ul>
<li>减少数据的处理量</li>
</ul>
<h3 id="使用limit分页">使用limit分页</h3>
<pre><code class="language-sql">select * from user limit startIndex, pageSize;
</code></pre>
<p>使用mybatis实现分页，核心SQL</p>
<ol>
<li>
<p>接口</p>
<pre><code class="language-java">// 分页
List&lt;User&gt; getUserByLimit(Map&lt;String, Integer&gt; map);
</code></pre>
</li>
<li>
<p>Maaper.xml</p>
<pre><code class="language-xml">&lt;!--分页--&gt;
&lt;select id=&quot;getUserByLimit&quot; parameterType=&quot;map&quot; resultMap=&quot;UserMap&quot;&gt;
    select * from mybatis.user limit #&#123;startIndex&#125;, #&#123;pageSize&#125;;
&lt;/select&gt;
</code></pre>
</li>
<li>
<p>测试</p>
<pre><code class="language-java">@Test
public void getUserByLimit()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    Map&lt;String, Integer&gt; map = new HashMap&lt;String, Integer&gt;();
    map.put(&quot;startIndex&quot;, 0);
    map.put(&quot;pageSize&quot;, 2);
    List&lt;User&gt; userList = mapper.getUserByLimit(map);
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
&#125;
</code></pre>
</li>
</ol>
<h3 id="RowBounds分页">RowBounds分页</h3>
<p>不再使用SQL实现分页</p>
<ol>
<li>
<p>接口</p>
<pre><code class="language-java">// 分页2
List&lt;User&gt; getUserByRowBounds();
</code></pre>
</li>
<li>
<p>Mapper.xml</p>
<pre><code class="language-xml">&lt;!--分页2--&gt;
&lt;select id=&quot;getUserByRowBounds&quot; resultMap=&quot;UserMap&quot;&gt;
    select * from mybatis.user;
&lt;/select&gt;
</code></pre>
</li>
<li>
<p>测试</p>
<pre><code class="language-java">@Test
public void getUserByRowBounds()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    // RowBounds实现
    RowBounds rowBounds = new RowBounds(0, 2);

    // 通过Java代码层面实现分页
    List&lt;User&gt; userList = sqlSession.selectList(&quot;com.xoitao.dao.UserMapper.getUserByRowBounds&quot;, null, rowBounds);
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
    sqlSession.close();
&#125;
</code></pre>
</li>
</ol>
<h3 id="分页插件">分页插件</h3>
<p><img src="/images/image-20240405210201059.png" alt="image-20240405210201059"></p>
<p>了解即可，万一以后公司的架构师，说要使用，你需要知道他是什么东西！</p>
<h2 id="使用注解开发">使用注解开发</h2>
<h3 id="面向接口编程">面向接口编程</h3>
<ul>
<li>大家之前都学习过面向对象编程，也学习过接口，但在真正的开发中，很多时候我们会选择面向接口</li>
<li>根本原因：==解耦==，可拓展，提高复用，分层开发中，上层不用管具体的实现，大家都遵守共同的标准，使得开发变得容易，规范性更好！</li>
<li>在一个面向对象的系统中，系统的各种功能是由许许多多的不同对象协作完成的。在这种情况下，各个对象内部是如何实现自己的，对系统设计人员来讲就不那么重要了；</li>
<li>而各个对象之间的协作关系则成为系统设计的关键。小到不同类之间的通信，大到各模块之间的交互，在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容。面向接口编程就是按照这种思想来编程。</li>
</ul>
<p><strong>关于接口的理解</strong></p>
<ul>
<li>接口从更深层次的理解，应是定义（规范，约束）与实现（名实分离的原则）的分离。</li>
<li>接口的本身反映了系统设计人员对系统的抽象理解</li>
<li>接口因该有两类
<ul>
<li>第一类是对一个个体的抽象，他可对应为一个抽象体（abstract class）</li>
<li>第二类是对一个个体某一方面的抽象，即形成一个抽象面（interface）</li>
</ul>
</li>
<li>一个个体有可能有多个抽象面。抽象体与抽象面是有区别的。</li>
</ul>
<p>三个面向区别</p>
<ul>
<li>面向对象是指，我们考虑问题时，以对象为单位，考虑它的属性及方法</li>
<li>面向过程是指，我们考虑问题时，以一个具体的流程（事务过程）为单位，考虑它的实现</li>
<li>接口设计与非接口设计是针对复用技术而言的，与面向对象（过程）不是一个问题，更多的体现就是对系统整体的架构</li>
</ul>
<h3 id="使用注解开发-2">使用注解开发</h3>
<ol>
<li>
<p>注解在接口上实现</p>
<pre><code class="language-java">    @Select(&quot;select * from mybatis.user&quot;)
    List&lt;User&gt; getUsers();
</code></pre>
</li>
<li>
<p>需要在核心配置文件中绑定接口！</p>
<pre><code class="language-xml">&lt;!--绑定接口--&gt;
&lt;mappers&gt;
&lt;mapper class=&quot;com.xoitao.dao.UserMapper&quot;/&gt;
&lt;/mappers&gt;
</code></pre>
</li>
<li>
<p>测试</p>
<pre><code class="language-java">@Test
public void getUsers()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    // 底层主要应用反射
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    List&lt;User&gt; userList = mapper.getUsers();
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
    sqlSession.close();
&#125;
</code></pre>
</li>
</ol>
<p>本质：反射机制实现</p>
<p>底层：动态代理！</p>
<p><img src="/images/image-20240406153652637.png" alt="image-20240406153652637"></p>
<h3 id="CRUD-2">CRUD</h3>
<p>我们可以在工具类创建的时候实现自动提交事务！</p>
<pre><code class="language-java">public static SqlSession getSqlSession() &#123;
    return sqlSessionFactory.openSession(true);
&#125;
</code></pre>
<p>编写接口，增加注解</p>
<pre><code class="language-java">@Select(&quot;select * from mybatis.user&quot;)
List&lt;User&gt; getUsers();

// 方法存在多个参数，所有的参数面前必须加上@Param注解
@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)
User getUserById(@Param(&quot;id&quot;) int id);

@Insert(&quot;insert into user(id, name, pwd) values (#&#123;id&#125;, #&#123;name&#125;, #&#123;password&#125;)&quot;)
int addUser(User user);

@Update(&quot;update user set name = #&#123;name&#125;, pwd = #&#123;password&#125; where id = #&#123;id&#125;&quot;)
int updateUser(User user);

@Delete(&quot;delete from user where id = #&#123;id&#125;&quot;)
int deleteUser(@Param(&quot;id&quot;) int id);
</code></pre>
<p>测试类</p>
<pre><code class="language-java">@Test
public void getUsers() &#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    // 底层主要应用反射
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    List&lt;User&gt; userList = mapper.getUsers();
    for (User user : userList) &#123;
        System.out.println(user);
    &#125;
    sqlSession.close();
&#125;

@Test
public void getUserById() &#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    User user = mapper.getUserById(1);
    System.out.println(user);
    sqlSession.close();
&#125;

@Test
public void addUser() &#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    mapper.addUser(new User(5, &quot;赵六&quot;, &quot;123456&quot;));

    sqlSession.close();
&#125;

@Test
public void updateUser()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    mapper.updateUser(new User (1, &quot;张三&quot;, &quot;123456&quot;));
    sqlSession.close();
&#125;

@Test
public void deleteUser()&#123;
    SqlSession sqlSession = MybatisUtils.getSqlSession();
    UserMapper mapper = sqlSession.getMapper(UserMapper.class);
    mapper.deleteUser(5);
    sqlSession.close();
&#125;
</code></pre>
<p><strong>关于@Param()注解</strong></p>
<ul>
<li>基本类型的参数或者String类型，需要加上</li>
<li>引用类型不需要加</li>
<li>如果只有一个基本类型的话们可以忽略，但是建议大家都加上！</li>
<li>我们在SQL中引用的就是我们这里的@Param()中设定的属性名</li>
</ul>
<p><strong>#{}      ${}区别</strong></p>
<h2 id="Lombok">Lombok</h2>
<p>Lombok项目是一个java库，它可以自动插入到<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%BC%96%E8%BE%91%E5%99%A8/9067697?fromModule=lemma_inlink">编辑器</a>和构建工具中，增强java的性能。不需要再写getter、setter或<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/equals/4481402?fromModule=lemma_inlink">equals</a>方法，只要有一个注解，就有一个功能齐全的构建器、自动记录变量等等</p>
<p>使用步骤：</p>
<ol>
<li>
<p>在IDEA中安装Lombok插件</p>
</li>
<li>
<p>在项目中导入Lombok的jar包</p>
<pre><code class="language-xml">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;version&gt;1.18.32&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>在实体类上加注解即可</p>
<pre><code class="language-java">@Data：无参构造，get，set，toString，hashCode，equals
@AllArgsConstructor
@NoArgsConstructor
</code></pre>
</li>
<li>
<p>说明</p>
<pre><code class="language-java">@Getter and @Setter
@FieldNameConstants
@ToString
@EqualsAndHashCode
@AllArgsConstructor, @RequiredArgsConstructor and @NoArgsConstructor
@Log, @Log4j, @Log4j2, @Slf4j, @XSlf4j, @CommonsLog, @JBossLog, @Flogger, @CustomLog
@Data
@Builder
@SuperBuilder
@Singular
@Delegate
@Value
@Accessors
@Wither
@With
@SneakyThrows
@val
@var
experimental @var
@UtilityClass
</code></pre>
</li>
</ol>
<h2 id="多对一">多对一</h2>
<ul>
<li>对个学生，对应一个老师</li>
<li>对于学生而言，关联，多个学生 关联一个老师【多对一】</li>
<li>对于老师而言，集合，一个老师，有很多学生【一对多】</li>
</ul>
<p>SQL：</p>
<pre><code class="language-sql">CREATE TABLE `teacher` (
    `id` INT(10) NOT NULL,
    `name` VARCHAR(30) DEFAULT NULL,
    PRIMARY KEY (`id`)
) ENGINE=INNODB DEFAULT CHARSET=utf8

INSERT INTO teacher(`id`, `name`) VALUES (1, '秦老师'); 

CREATE TABLE `student` (
    `id` INT(10) NOT NULL,
    `name` VARCHAR(30) DEFAULT NULL,
    `tid` INT(10) DEFAULT NULL,
    PRIMARY KEY (`id`),
    KEY `fktid` (`tid`),
    CONSTRAINT `fktid` FOREIGN KEY (`tid`) REFERENCES `teacher` (`id`)
) ENGINE=INNODB DEFAULT CHARSET=utf8
INSERT INTO `student` (`id`, `name`, `tid`) VALUES ('1', '小明', '1'); 
INSERT INTO `student` (`id`, `name`, `tid`) VALUES ('2', '小红', '1'); 
INSERT INTO `student` (`id`, `name`, `tid`) VALUES ('3', '小张', '1'); 
INSERT INTO `student` (`id`, `name`, `tid`) VALUES ('4', '小李', '1'); 
INSERT INTO `student` (`id`, `name`, `tid`) VALUES ('5', '小王', '1');
</code></pre>
<h3 id="测试环境搭建"><strong>测试环境搭建</strong></h3>
<ol>
<li>导入Lombok</li>
<li>新建实体类Teacher，Student</li>
<li>建立Mapper接口</li>
<li>建立Mapper.xml文件</li>
<li>在核心配置文件中绑定注册我们的Mapper接口或者xml文件</li>
<li>测试查询是否能够成功！</li>
</ol>
<h3 id="按照查询嵌套处理">按照查询嵌套处理</h3>
<pre><code class="language-xml">&lt;!--
        思路：
        1. 查询所有的学生信息
        2. 根据查询出来的学生的id，寻找对应的老师！
    --&gt;
&lt;resultMap id=&quot;StudentTeacher&quot; type=&quot;Student&quot;&gt;
    &lt;result property=&quot;id&quot; column=&quot;id&quot;/&gt;
    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;
    &lt;!--复杂的属性，我们需要单独处理  对象：association   集合：collection--&gt;
    &lt;association property=&quot;teacher&quot; column=&quot;tid&quot; javaType=&quot;Teacher&quot; select=&quot;getTeacher&quot;/&gt;
&lt;/resultMap&gt;
&lt;select id=&quot;getStudent&quot; resultMap=&quot;StudentTeacher&quot;&gt;
    select * from student;
&lt;/select&gt;
&lt;select id=&quot;getTeacher&quot; resultType=&quot;Teacher&quot;&gt;
    select * from teacher where id = #&#123;id&#125;;
&lt;/select&gt;
</code></pre>
<h3 id="按照结果嵌套处理">按照结果嵌套处理</h3>
<pre><code class="language-xml">&lt;!--按照结果嵌套处理--&gt;
&lt;select id=&quot;getStudent2&quot; resultMap=&quot;StudentTeacher2&quot;&gt;
    select s.id sid, s.name sname, t.id tid, t.name tname from student s, teacher t where s.tid = t.id;
&lt;/select&gt;
&lt;resultMap id=&quot;StudentTeacher2&quot; type=&quot;Student&quot;&gt;
    &lt;result property=&quot;id&quot; column=&quot;sid&quot;/&gt;
    &lt;result property=&quot;name&quot; column=&quot;sname&quot;/&gt;
    &lt;association property=&quot;teacher&quot; javaType=&quot;Teacher&quot;&gt;
        &lt;result property=&quot;id&quot; column=&quot;tid&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;
    &lt;/association&gt;
&lt;/resultMap&gt;
</code></pre>
<p>回顾Mysql多对一查询方式</p>
<ul>
<li>子查询</li>
<li>联表查询</li>
</ul>
<h2 id="一对多">一对多</h2>
<p>比如：一个老师拥有多个学生！</p>
<p>对于老师而言，就是一对多的关系！</p>
<h3 id="环境搭建，和刚才一样">环境搭建，和刚才一样</h3>
<p>实体类</p>
<pre><code class="language-java">@Data
public class Student &#123;
    private int id;
    private String name;
    private int tid;
&#125;
</code></pre>
<pre><code class="language-java">@Data
public class Teacher &#123;
    private int id;
    private String name;
    // 一个老师拥有对个学生
    private List&lt;Student&gt; studentList;
&#125;
</code></pre>
<h3 id="按照结果嵌套处理-2">按照结果嵌套处理</h3>
<pre><code class="language-xml">&lt;!--按结果嵌套查询--&gt;
&lt;resultMap id=&quot;TeacherStudent&quot; type=&quot;Teacher&quot;&gt;
    &lt;result property=&quot;id&quot; column=&quot;tid&quot;/&gt;
    &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;
    &lt;!--复杂的属性，我们需要单独处理  对象：association   集合：collection--&gt;
    &lt;!--集合中的泛型我们使用ofType获取--&gt;
    &lt;collection property=&quot;studentList&quot; ofType=&quot;Student&quot;&gt;
        &lt;result property=&quot;id&quot; column=&quot;sid&quot;/&gt;
        &lt;result property=&quot;name&quot; column=&quot;tname&quot;/&gt;
        &lt;result property=&quot;tid&quot; column=&quot;tid&quot;/&gt;
    &lt;/collection&gt;
&lt;/resultMap&gt;
&lt;select id=&quot;getTeacherById&quot; parameterType=&quot;int&quot; resultMap=&quot;TeacherStudent&quot;&gt;
    select s.id sid, s.name sname, t.id tid, t.name tname from student S, teacher t where s.tid = t.id and t.id = #&#123;tid&#125;;
&lt;/select&gt;
</code></pre>
<h3 id="按照查询嵌套处理-2">按照查询嵌套处理</h3>
<pre><code class="language-xml">&lt;!--按照查询嵌套处理--&gt;
&lt;select id=&quot;getTeacherById2&quot; parameterType=&quot;int&quot; resultMap=&quot;TeacherStudent2&quot;&gt;
    select * from teacher where id = #&#123;tid&#125;
&lt;/select&gt;

&lt;resultMap id=&quot;TeacherStudent2&quot; type=&quot;Teacher&quot;&gt;
    &lt;result property=&quot;id&quot; column=&quot;id&quot;/&gt;
    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;
    &lt;collection property=&quot;studentList&quot; ofType=&quot;Student&quot; select=&quot;getStudent&quot; column=&quot;id&quot;/&gt;
&lt;/resultMap&gt;

&lt;select id=&quot;getStudent&quot; resultType=&quot;Student&quot;&gt;
    select * from student where tid = #&#123;tid&#125;
&lt;/select&gt;
</code></pre>
<h3 id="小结">小结</h3>
<ol>
<li>关联 - association【多对一】</li>
<li>集合 - collection   【一对多】</li>
<li>javaType    &amp;      ofType
<ol>
<li>javaType 用来指定实体类中属性的类型</li>
<li>ofType     用来指定到映射到List或者集合中的pojo类型，泛型汇总的约束类型！</li>
</ol>
</li>
</ol>
<p>注意点：</p>
<ul>
<li>保证SQL的可读性、尽量保证通俗易懂</li>
<li>注意一对多和多对一种，属性名和字段的问题</li>
<li>如果问题不好排查错误，可以使用日志，建议使用Log4j</li>
</ul>
<p>面试高频</p>
<ul>
<li>Mysql引擎</li>
<li>InnoDB底层原理</li>
<li>索引</li>
<li>索引优化</li>
</ul>
<h2 id="动态SQL">动态SQL</h2>
<p>==什么是动态SQL：动态SQL就是根据不同的条件生成不同的SQL语句==</p>
<p>如果你之前用过 JSTL 或任何基于类 XML 语言的文本处理器，你对动态 SQL 元素可能会感觉似曾相识。在 MyBatis 之前的版本中，需要花时间了解大量的元素。借助功能强大的基于 OGNL 的表达式，MyBatis 3 替换了之前的大部分元素，大大精简了元素种类，现在要学习的元素种类比原来的一半还要少。</p>
<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)</li>
<li>foreach</li>
</ul>
<p>搭建环境</p>
<pre><code class="language-sql">CREATE TABLE `blog`(
    `id` VARCHAR(50) NOT NULL COMMENT '博客id',
    `title` VARCHAR(100) NOT NULL COMMENT '博客标题',
    `author` VARCHAR(30) NOT NULL COMMENT '博客作者',
    `create_time` DATETIME NOT NULL COMMENT '创建时间',
    `views` INT(30) NOT NULL COMMENT '浏览量'
)ENGINE=INNODB DEFAULT CHARSET=utf8
</code></pre>
<p>创建一个基础工程</p>
<ol>
<li>
<p>导包</p>
</li>
<li>
<p>编写配置文件</p>
</li>
<li>
<p>编写实体类</p>
<pre><code class="language-java">@Data
public class Blog &#123;
    private int id;
    private String title;
    private String author;
    private Date createTime;
    private int views;
&#125;
</code></pre>
</li>
<li>
<p>编写实体类对应Mapper接口和Mapper.xml文件</p>
</li>
</ol>
<h3 id="if">if</h3>
<pre><code class="language-xml">&lt;select id=&quot;queryBlogIf&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;
    select * from blog where 1=1
    &lt;if test=&quot;title != null&quot;&gt;
        and title = #&#123;title&#125;
    &lt;/if&gt;
    &lt;if test=&quot;author != null&quot;&gt;
        and author = #&#123;author&#125;
    &lt;/if&gt;
&lt;/select&gt;
</code></pre>
<h3 id="choose-when、otherwise">choose(when、otherwise)</h3>
<pre><code class="language-xml">&lt;select id=&quot;queryBlogChoose&quot; parameterType=&quot;map&quot; resultType=&quot;blog&quot;&gt;
    select * from blog
    &lt;where&gt;
        &lt;choose&gt;
            &lt;when test=&quot;title != null&quot;&gt;
                title = #&#123;title&#125;
            &lt;/when&gt;
            &lt;when test=&quot;author != null&quot;&gt;
                and author = #&#123;author&#125;
            &lt;/when&gt;
            &lt;otherwise&gt;
                and views = #&#123;views&#125;
            &lt;/otherwise&gt;
        &lt;/choose&gt;
    &lt;/where&gt;
&lt;/select&gt;
</code></pre>
<h3 id="trim-where、set">trim(where、set)</h3>
<pre><code class="language-xml">select * from blog
&lt;where&gt;
    &lt;if test=&quot;title != null&quot;&gt;
        title = #&#123;title&#125;
    &lt;/if&gt;
    &lt;if test=&quot;author != null&quot;&gt;
        and author = #&#123;author&#125;
    &lt;/if&gt;
&lt;/where&gt;
</code></pre>
<pre><code class="language-xml">&lt;update id=&quot;updateBlog&quot; parameterType=&quot;map&quot;&gt;
    update blog
    &lt;set&gt;
        &lt;if test=&quot;title != null&quot;&gt;
            title = #&#123;title&#125;,
        &lt;/if&gt;
        &lt;if test=&quot;author != null&quot;&gt;
            author = #&#123;author&#125;
        &lt;/if&gt;
    &lt;/set&gt;
    where id = #&#123;id&#125;
&lt;/update&gt;
</code></pre>
<p>==所谓的动态SQL，本质还是SQL语句，只是我们可以在SQL层面，去执行一个逻辑代码==</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2024/03/08/images/" title="Images"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: Images</span></a><a class="button is-default" href="/2023/12/24/hello-world/" title="Hello World"><span class="has-text-weight-semibold">Next: Hello World</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xoitao/xoitao.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/xoitao"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><a title="zhihu" target="_blank" rel="noopener nofollow" href="//zhihu.com//"><i class="iconfont icon-zhihu"></i></a><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> xoitao 2024</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>